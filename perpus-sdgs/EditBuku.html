<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Edit Buku</title>
  <link rel="stylesheet" href="DaftarBuku.css">
</head>
<body>
  <h2>Edit Buku</h2>

  <form id="editForm" method="post" action="EditBuku.php" enctype="multipart/form-data">
    <input type="hidden" name="id" id="id">

    <label>Judul:</label>
    <input type="text" name="judul" id="judul" required><br>

    <label>Penulis:</label>
    <input type="text" name="penulis" id="penulis" required><br>

    <label>Tahun:</label>
    <input type="number" name="tahun" id="tahun" required><br>

    <label>ISBN:</label>
    <input type="text" name="isbn" id="isbn" required><br>

    <label>Kategori:</label>
    <input type="text" name="kategori" id="kategori" required><br>

    <label>Stock:</label>
    <input type="number" name="stock" id="stock" required><br>

    <label>Cover (Opsional):</label>
    <input type="file" name="cover"><br>

    <input type="submit" name="submit" value="Update">
    <button type="button" onclick="hapusBuku()">Hapus</button>
  </form>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // Ambil ID buku dari query string
      const urlParams = new URLSearchParams(window.location.search);
      const id = urlParams.get("id");

      if (!id) {
        alert("ID buku tidak ditemukan!");
        return;
      }

      // Set ID ke field tersembunyi
      document.getElementById("id").value = id;

      // Ambil data buku dari PHP menggunakan Fetch API
      fetch("EditBuku.php?id=" + id)
        .then(response => response.json())
        .then(data => {
          if (data.error) {
            alert(data.error);
            return;
          }
          // Isi form dengan data buku
          document.getElementById("judul").value = data.title;
          document.getElementById("penulis").value = data.author;
          document.getElementById("tahun").value = data.year;
          document.getElementById("isbn").value = data.isbn;
          document.getElementById("kategori").value = data.category;
          document.getElementById("stock").value = data.stock;  // Menambahkan stock
        })
        .catch(error => {
          console.error("Gagal fetch data buku:", error);
        });
    });
    
    function hapusBuku() {
    const id = document.getElementById("id").value;
    if (confirm("Apakah Anda yakin ingin menghapus buku ini?")) {
      fetch("EditBuku.php", {
        method: "POST",
        headers: {
          "Content-Type": "application/x-www-form-urlencoded",
        },
        body: `hapus=1&id=${id}`
      })
      .then(res => res.text())
      .then(response => {
        alert("Buku berhasil dihapus!");
        window.location.href = "DaftarBukuUser.html";
      })
      .catch(err => {
        console.error("Gagal menghapus buku:", err);
        alert("Gagal menghapus buku!");
      });
    }
  }
  </script>
</body>
</html>
